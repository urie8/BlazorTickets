@page "/"
@using ClientApp.Services
@using Shared.Models
@using System.Diagnostics
@inject IApiCaller ApiCaller
<PageTitle>Home</PageTitle>


<TicketForm></TicketForm>

@if (FilteredTickets.Any())
{
    @foreach (var ticket in FilteredTickets)
    {
             <Ticket CurrentTicket="ticket"></Ticket>
    }

}
else
{
    @foreach (var ticket in Tickets)
    {
            <Ticket CurrentTicket="ticket"></Ticket>
    }

}


@code{
    public List<TicketModel> Tickets { get; set; } = new();

    public List<TicketModel> FilteredTickets { get; set; } = new();

    public string? InputValue;


    protected override async Task OnInitializedAsync(){
        try
        {
            Tickets = await ApiCaller.GetTickets();

        }
        catch (Exception ex)
        {
            Trace.WriteLine(ex); 
        }
    }


    public void FilterList()
    {
        FilteredTickets = new();

        foreach (var ticket in Tickets.Where(t => t.Title.Contains(InputValue)))
        {
                FilteredTickets.Add(ticket);
        }
    }
}